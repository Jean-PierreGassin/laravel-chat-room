<!DOCTYPE html>

<html>
<head>
	<meta charset="utf-8">
	<title>Chatroom</title>
	<style>
	* { margin: 0; padding: 0; box-sizing: border-box; }
	body { font: 13px Helvetica, Arial; }
	form { background: #9FB4C7; padding: 2px; position: fixed; bottom: 0; width: 100%; }
	form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
	form input:focus { outline: none; }
	form button { width: 9%; background: #9FB4C7; color: #fff; border: none; padding: 10px; }
	#messages { float: right; list-style-type: none; margin-bottom: 60px; padding: 0; width: 85%; word-wrap: break-word; }
	#messages li { padding: 5px 10px; }
	#messages li:nth-child(odd) { background: #eee; }
	#typing { color: #000; padding: 3px; position: fixed; left: 15%; bottom: 38px; width: 85%; word-wrap: break-word; }
	#online { float: left; position: fixed; border-right: 1px solid #9FB4C7; height: 100vh; margin-right: 20px; min-width: 15%; background: #fff; list-style-type: none;}
	#online li { width: 100%; padding: 5px 10px; }
	#online li:nth-child(odd) { background: #eee; }
	.online::before { content: " "; border-radius: 20px; background-color: green; display: inline-block; width: 5px; height: 5px; margin-right: 10px; }
	</style>
</head>
<body>
	<ul id="online"></ul>
	<ul id="messages"></ul>
	<ul id="typing"></ul>
	
	<form>
		<input id="m" autocomplete="off" autofocus><button>Send</button>
	</form>

	<script src="/socket.io/socket.io.js"></script>
	<script src="/scripts/"></script>
	<script>
	var socket = io.connect('http://localhost:3000', {reconnect: true});
	var user = '';

	while (user.length <= 1) {
		var user = prompt('What\'s your name?').trim();

		if (user.length > 12) {
			var user = prompt('Please enter a name that is 12 characters or less:').trim();
		}
	}

	$('html').on('click', function() {
		$('#m').focus();
	});

	$('form').submit(function(e){
		e.preventDefault();

		var message = {
			user: user,
			message: $('#m').val().trim()
		}

		if (message.message.length < 1) {
			return false;
		}

		socket.emit('chat message', message);
		$(this).trigger('reset');
	});

	$('form').on('keypress', function() {
		socket.emit('typing', user);
	});

	socket.on('connect', function(msg){
		socket.emit('join', user);
		socket.emit('user connected', user);
	});

	socket.on('disconnect', function(msg){
		$('#messages').append($('<li>').text(msg.user + ' has disconnected.'));
		$('#online').empty();

		msg.clients.forEach(function(client){
			$('#online').append($('<li class="online">').text(client));
		});

		$('html, body').animate({ scrollTop: $('#messages').height()}, 'slow');
	});

	socket.on('chat message', function(msg){
		$('#messages').append($('<li>').text(msg.user + ': ' + msg.message));
		$('html, body').animate({ scrollTop: $('#messages').height()}, 'slow');
	});

	socket.on('user connected', function(msg){
		$('#messages').append($('<li>').text(msg.connected));
		$('html, body').animate({ scrollTop: $('#messages').height()}, 'slow');
		$('#online').empty();

		msg.clients.forEach(function(client){
			$('#online').append($('<li class="online">').text(client));
		});
	});

	socket.on('typing', function(msg){
		$('#typing').text(msg);
	});

	setInterval(function(){
		if ($('#typing').text === '') {
			return;
		}
		$('#typing').text('');
	}, 1000);
	</script>
</body>
</html>
